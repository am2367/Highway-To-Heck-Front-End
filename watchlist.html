<!DOCTYPE html>
<html lang="en">
<head>
  <title>Highway to Heck</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- required files -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.0/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css" />
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.0/js/dataTables.responsive.js"></script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.16/dataRender/ellipsis.js"></script>
</head>
<script>
$(document).ready(function(){
		$('#example').DataTable({ 
			dataSrc: "", 
			responsive:true, 
			"proccessing":true,
			"ajax": {
			    "url": "handleRequests.php",
			    "type": "POST",
			    "data": {"user": "admin"}
			},
			columns:[
			{ "data": "title" },
			{ "data": "company" },
			{ "data": "location" },
			{ "data": "type" },
			{ "data": "description", render: $.fn.dataTable.render.ellipsis(50, true)},
			{ "data": "created_at" },
			{ "data": "how_to_apply" },
			{ "data": "url", "render": function(data, type, row, meta){
			return '<a href="' + data + '"class="btn btn-info" role="button">Link</a>'}},
			{ "data": null, "defaultContent":"<button id=\"Remove\">Remove</button>"},
			{ "data": "id" }],
		});
		
});
$(document).on('click', '#Remove', function(){
	var id = (($(this).parents('tr'))[0]).lastChild.textContent;
	removeFromWatchlist(id, $(this));
});
function removeFromWatchlist(listingID, button){
		var request = new XMLHttpRequest();
		request.open("POST","handleRequests.php",true);
		request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
		request.onreadystatechange= function()
		{
		
			if ((this.readyState == 4)&&(this.status == 200))
			{
				handleRemove(this.responseText, button);					
			}		
		}
		request.send("data=addToWatchlist" + "&listingID=" + listingID);	
}
function handleRemove(response, button){
		var obj = JSON.parse(response);
		if(obj["status"] == true){
			button.parents('tr').remove();
		}
		else
			alert("There was an error removing the listing from your watchlist! Please try again.")
};
</script>
<!-- loads nav bar -->
<script>
	$(document).ready(function(){
		$("#nav").load("navbar.html");
	}); 
</script>

<body>

<!-- nav bar -->
<nav id="nav"></nav>

<div class="container">
	<div class="panel panel-default">
		<div class="panel panel-body">
		 <table id="watchlist" class="table table-striped table-bordered" width="100%" cellspacing="0">
			<thead>
			    <tr>
				<th>id</th>
				<th>makeName</th>
				<th>modelName</th>
				<th>makeYear</th>
				<th>vehiclePrice</th>
				<th>miles</th>
				<th>exteriorColor</th>
				<th>Remove from Watchlist</th>
			    </tr>
			</thead>
			<tbody>
			</tbody>
		    </table>
		</div>
	</div>
</div>
</body>
</html>
